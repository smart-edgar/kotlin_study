# 아이템36. 상송보다는 컴포지션을 사용하라

상속은 굉장히 강력한 기능으로 'is-a' 관계의 객체 계층 구조를 만들기 위해 설계되었습니다.<br>
상속은 관계가 명확하지 않을 때 사용하면 여러가지 문제가 발생할 수 있습니다. 따라서 단순하게 코드 추출 또는 재사용을 위해 상속을 하려고 한다면, 조금 더 신중하게 생각해야 합니다.

## 간단한 행위 재사용
유사한 동작을 하는 두개의 클래스가 있다면 슈퍼클래스를 만들어서 공통되는 행위를 추출합니다.<br>
이러한 코드는 몇가지 단점이 있습니다.
- 상속은 하나의 클래스만을 대상으로 할수 있습니다.
- 상속은 클래스의 모든것을 가져오게 됩니다. 불필요한 함수를 갖는 클래스가 만들어질 수 있습니다.(인터페이스 분리 원칙을 위반)
- 상속은 이해하기 어렵습니다. 메서드를 읽고 이해하기 위해 슈퍼클래스를 여러번 확인해야 한다면 문제가 있는것입니다. 

컴포지션은 객체를 프로퍼티로 갖고 함수를 호출하는 형태로 재사용하는 것을 의미합니다.<br>
컴포지션을 활용하면 하나의 클래스 내부에서 여러 기능을 재사용할 수 있게 됩니다.<br>

하나 이상의 클래스를 상속할 수는 없습니다.<br>
상속으로 이를 구현하려면 두 기능을 하나의 슈퍼클래스에 배치해야합니다. 이떄문에 클래스에 복잡한 계층 구조가 만들어 질수 있습니다.
이러한 계층 구조는 이해하기도 어렵고 수정하기도 어렵습니다.<br>



## 모든 것을 가져올 수 밖에 없는 상속
상속은 슈퍼클래스의 메서드, 제약, 행위 등 모든것을 가져옵니다.<br>
따라서 상속은 객체의 계층 구조를 나타낼 때 굉장히 좋은 도구 입니다. 하지만 일부분을 재사용하기 위한 목적으로는 적합하지 않습니다.<br>
일부분 재사용은 컴포지션이 좋습니다.<br>
상속은 필요없는 메서드를 갖기 때문에 인터페이스 분리 원칙에 위반됩니다. 또한 슈퍼클레스의 동작을 서브클레스에서 깨버리므로 리스코프 치환 원칙에도 위반됩니다.<br>
코틀린은 다중 상속을 지원하지 않습니다.<br>
컴포지션이 무조건 좋다는것은 아닙니다. 타입 계층 구조를 표현해야한다면 인터페이스를 활용해서 다중 상속하는것이 좋을 수 있습니다.


## 캡슐화를 꺠는 상속
상속을 활용할 때는 외부에서 이를 어떻게 활용하는지도 중요하지만 내부적으로 이를 어떻게 활용하는지도 중요합니다.<br>
[fun06.kt](fun06.kt) 코드는 addAll 내부에서 add를 사용하기 때문에 정상적으로 동작하지 않습니다.<br>
간단하게 addAll 함수를 제거하면 정상동작 합니다.<br>
하지만 이러한 방법은 위험할수 있습니다. 자바에서 HashSet의 addAll을 최적화하면서 내부적으로 add를 호출하지 않는 방식으로 변경하면 업데이트 이후 예상하지 못한 형태로 동작합니다.<br>
이럴때도 상속 대신 컴포지션을 이용하면 됩니다.

지금까지 살펴본 예제처럼 다형성이 필요한데 상속된 메서드를 직접 활용하는 것이 위험할때는 위임 패턴을 사용하는 것이 좋습니다.<br>
하지만 다형성이 그렇게 까지 필요한 경우는 별로 없습니다.<br>
단순하게 컴포지션을 활용하면 해결되는 경우가 많습니다. 컴포지션을 이용한 코드는 이해하기 귀우며 유연하기까지 합니다.

상속으로 캡슐화를 깰 수 있다는 사실은 보안문제입니다.<br>
대부분의 경우에 이러한 행위는 규약으로 지정되어 있거나 서브 클래스에 의존할 필요가 없는 경우입니다.

컴포지션은 재사용하기 쉽고 더 많은 유연성을 제공합니다.


## 오버라이딩 제한하기
상속용으로 설계되지 않은 클래스를 상속하지 못하게 하려면 final을 사용하면 됩니다.<br>
하지만 상속은 허용하지만 메서드는 오버라이드 하지 못하게 만들고 싶은 경우는 메서드에 open 키워드를 사용하면 됩니다.<br>
상속용으로 설계된 메서드에만 open을 붙이면 됩니다. 참고로 메서드를 오버라이드 할때 서브클래스에서 해당 메서드에 final을 붙일수도 있습니다.<br>
이를 활용하면 서브 클래스에서 오버라이드를 할 수 있는 메서드를 제한 할수 있습니다.


## 정리
컴포지션과 상속은 다음과 같은 차이가 있습니다.
- 컴포지션은 더 안전합니다.
- 컴포지션은 더 유연합니다. 컴포지션은 필요한것만 받을수 있습니다.
- 컴포지션은 더 명확합니다. 장점이자 단점.
- 컴포지션은 생각보다 번거롭습니다.
- 상속은 다형성을 활용할수 있습니다. 양날의 검. 편리하게 활용할수 있으나 제한이 발생. 슈퍼클래스와 서브클래스의 규약을 잘 지켜야함.

OOP에서는 상속보다 컴포지션을 사용하는것이 좋습니다.
